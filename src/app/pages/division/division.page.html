<ion-header [translucent]="true">
  <ion-toolbar color="danger">
    <ion-buttons slot="start">
      <ion-menu-button>
      </ion-menu-button>
      <ion-button>
        <ion-icon src="../../assets/icon/logo.svg">
        </ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>
      Scorecard
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ng-container *ngIf="pnriData; else elseTemplate">
    <ion-grid>
      <ion-row>
        <ion-col>
          <ion-item>
            <ion-label position="stacked">
              Pick
              Starting Period
            </ion-label>
            <ion-icon slot="start" name="calendar">
            </ion-icon>
            <ion-input value="{{ periodStarting | date: 'MMM yyyy'  }}" id="divisionDateStarting"
              placeholder="Starting">
            </ion-input>
            <ion-popover trigger="divisionDateStarting" size="calendar">
              <ng-template>
                <ion-datetime (ionChange)="onStartingPeriodSelected($event)" presentation="month-year"
                  [max]="periodEnding" cancelText="Cancel" [showDefaultButtons]="true" doneText="Set">
                </ion-datetime>
              </ng-template>
            </ion-popover>
          </ion-item>
        </ion-col>
        <ion-col>
          <ion-item>
            <ion-label position="stacked">
              Pick
              Ending Period
            </ion-label>
            <ion-icon slot="start" name="calendar">
            </ion-icon>
            <ion-input value="{{ periodEnding | date: 'MMM yyyy' }}" id="divisionDateEnding" placeholder="Ending">
            </ion-input>
            <ion-popover trigger="divisionDateEnding" size="calendar">
              <ng-template>
                <ion-datetime (ionChange)="onEndingPeriodSelected($event)" presentation="month-year"
                  [min]="periodStarting" cancelText="Cancel" [showDefaultButtons]="true" doneText="Set">
                </ion-datetime>
              </ng-template>
            </ion-popover>
          </ion-item>
        </ion-col>
        <ion-col>
          <ion-item>
            <ion-icon name="map" slot="start">
            </ion-icon>
            <ion-label position="stacked">
              Division
            </ion-label>
            <ion-select interface="action-sheet" placeholder="Select Division" (ionChange)="onDivisionSelected($event)">
              <ion-select-option *ngFor="let division of pnriData.division_scorecards.scorecards" [value]="division">
                {{division.division}}
              </ion-select-option>
            </ion-select>
          </ion-item>
        </ion-col>
        <ion-col>
          <ion-item>
            <ion-icon name="location" slot="start">
            </ion-icon>
            <ion-label position="stacked">
              District
            </ion-label>
            <ion-select interface="action-sheet" placeholder="Select District" (ionChange)="onDistrictSelected($event)"
              mode="ios" #district>
              <ion-select-option *ngFor="let district of districtScoreCards" [value]="district">
                {{district.district}}
              </ion-select-option>
            </ion-select>
          </ion-item>
        </ion-col>
      </ion-row>
    </ion-grid>

    <ion-segment color="danger" [(ngModel)]="viewType" swipeGesture="true" (ionChange)="onSegmentChanged($event)">
      <ion-segment-button value="table" layout="icon-start">
        <ion-icon size="small" name="grid">
        </ion-icon>
        <ion-label>
          Table
        </ion-label>
      </ion-segment-button>
      <ion-segment-button value="map" layout="icon-start">
        <ion-icon size="small" name="map">
        </ion-icon>
        <ion-label>
          Map
        </ion-label>
      </ion-segment-button>
      <ion-segment-button value="graph" layout="icon-start">
        <ion-icon size="small" name="bar-chart">
        </ion-icon>
        <ion-label>
          Graph
        </ion-label>
      </ion-segment-button>
    </ion-segment>
    <div [ngSwitch]="viewType">
      <ion-grid *ngSwitchCase="'table'">
        <app-pnri [pnriCIStandardColumn]="pnriData.reginalPerformanceBasedOnCIStandards"
          [scoreCard]="currentScoreCards">
        </app-pnri>
      </ion-grid>
      <ion-grid *ngSwitchCase="'map'">

        <ion-grid>
          <ion-card>
            <ion-card-header>
              <ion-card-title>
                Performance Parameter of Division
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-row>
                <ion-col *ngFor="let box of pnriData.reginalPerformanceBasedOnCIColumn" size="6" sizeLg="4">
                  <li type="none"><span [attr.track]="box.key"></span>{{box.value}}</li>
                </ion-col>
              </ion-row>
            </ion-card-content>

          </ion-card>
        </ion-grid>
        <ion-popover #popover [isOpen]="isOpen" (didDismiss)="isOpen = false" side="right" alignment="top">
          <ng-template>
            <ion-content class="ion-padding">
              <ng-container *ngIf="hoverScoreCard; else elseTemplate">
                <p *ngFor="let keyObj of displayedColumns" attr.data-sectionvalue="{{keyObj.value}}: "
                  [attr.track]="getCILabel(hoverScoreCard[keyObj.key],keyObj.key)"
                  style="--rank: {{getColorForPercentage(hoverScoreCard.rank)}}">
                  <ion-label>
                    {{hoverScoreCard[keyObj.key] | pnriDecorator:keyObj}}
                  </ion-label>
                </p>
              </ng-container>
              <ng-template #elseTemplate>
                <h6>
                  No
                  Data
                  available
                  for
                  this
                  reason
                </h6>
              </ng-template>
            </ion-content>
          </ng-template>
        </ion-popover>
        <div #graphMapStandardsLegend id="graphMapStandardsLegend">
        </div>
        <div #performanceMapCanvas id="performanceMapCanvas">
        </div>
      </ion-grid>
      <div *ngSwitchCase="'graph'">
        <div>
          <ion-card>
            <ion-card-header color="danger">
              <ion-card-title class="ion-text-center">
                Division
                Performance
                Graph
              </ion-card-title>
            </ion-card-header>
            <div #divisionRankingGraphCanvas class="ion-padding-top" id="divisionRankingGraphCanvas">
            </div>
          </ion-card>
        </div>
        <div>
          <ion-card>
            <ion-card-header color="success">
              <ion-card-title class="ion-text-center">
                {{pnriData.division_scorecards.divisionStatusPieCartColumn.value}}
              </ion-card-title>
            </ion-card-header>
            <div #divisionSAMAdmittedGraphCanvas id="divisionSAMAdmittedGraphCanvas">
            </div>
          </ion-card>
        </div>
      </div>
    </div>
  </ng-container>
  <ng-template #elseTemplate>
    <app-skeleton>
    </app-skeleton>
  </ng-template>


</ion-content>